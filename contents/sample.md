# 사례(사내도서대여시스템)
사례는 사내 도서대여시스템(시스템명:티룸)이며 다음과 같은 과정을 거친다. 

1.요구사항 정의

2.이벤트 스토밍를 통한 마이크로서비스 도출


3.아키텍처정의 및 개발구조정의
- 아키텍처구성도
- 패키지구조정의

3.1 개발환경구축
- 로컬개발환경
- Jhipster로 마이크로서비스 개발환경 만들기
- 카프카설치

4.마이크로서비스별 설계/구현

5.프론트엔드 설계/개발

6.배포 및 빌드


## 1.요구사항 
### 1.1 요구사항 
<사용자관리 및 로그인>
- 사용자를 등록한다. 등록시 사내HR시스템에 검증된다.
- 특정사용자는 사서의 역할을 부여받는다.
- 사용자는 시스템 사용을 위해 로그인하거나,로그아웃 할수 있다.

<도서관리>
- 사서는 도서분류정보를 등록/수정/삭제한다.
- 사서는 입고된 도서를 분류하고 등록/수정/삭제한다.
- 사용자는 도서를 기증할 수 있다.
- 기증시 10포인트를 부여한다.
- 일반적인 도서는 도서공급사에 의해 공급된다.
- 각 도서는 대여할수있는 수량(재고)이 있으며 대여/반납에 의해 그 재고가 조정된다.

<도서대출 및 반납>
- 사용자는 도서를 검색한다.
- 사용자는 베스트대여목록를 조회한다.
- 사용자는 대여가능한 도서를 대여한다.(대여조건은 2주 1인당 5권이내이다.)
- 대여불가능한 도서는 예약할수 있다.
- 예약자는 순번이 부여된다.
- 대여 후 1.5주가 지나면 시스템은 반납요청메일을 보낸다.
- 사용자는 2주 한도인 도서를 1주 연장할 수 있다.
- 반납되지 않고 대여기간이 지난 도서는 연체된다.
- 연체시 사용자는 대여불가 상태가 된다.
- 사용자는 대여한 도서를 반납한다.
- 대여한 모든 도서 정보는 기록된다.
- 대여,반납시 사용자에게 10포인트가 부여된다.
- 연체일이 있는 사용자는 대여할 수 없다.(대여불가상태)
- 포인트는 연체일 1인당 10포인트의 비욜로 연체일을 삭제하는데 사용된다.
- 연체일을 0으로 만듦으로써 대여가능상태가 된다.

<배송>
- 원격지의 사용자는 배송을 요청할수 있다.
- 배송의 상태는 접수/준비/발송/배송완료 이다.
- 배송은 외부배송업체를 이용한다.

<이메일>
- 주요 업무 변화시 사용자에게 통보한다.


## 유스케이스 시나리오
1. 사용자 2명 등록한다. USER1,USER2
2. USER2에게 운영자 권한을 준다.
3. 운영자가 도서정보를 등록한다.
4. USER1이 도서정보를 검색한다. 
5. 대출가능한 도서를 2권 대출한다.
- 대출불가한 도서는 예약한다.
6. 대출한 도서를 1권 반납한다.
7. 2주가 지난도서는 연체된다.
8. 연체도서를 반납한다.
9. USER1이 다시 도서를 대출하려고 하나 시스템은 대출불가 메시지를 보낸다.
10. USER1은 연체일자를 확인하고 포인트로 연체를 해제한다.
11. USER1은 다시 대출가능상태가 되고 대출을 수행한다.

12.USER1의 라이브러리를 보면 2권의 반납이력이 존재하고 1권은 대출중이다.


주요 구현 기능

- 게시판 (단순CRUD?)
- 도서관리 (단순CRUD로 개발,또는 두가지 버전)
- 대출하기(동기,비동기처리)
- 반납하기(비동기처리)
- 연체처리(배치)
- 연체해제처리(포인트 사용)(비동기 처리?)
- 카탈로그 생성(CQRS,MongoDB 도서변경에 따른 결과적 일관성)


## 2.이벤트스토밍를 통한 마이크로서비스 도출

![subdomain](https://github.com/CNAPS-MSA/CNAPS3/blob/master/img/subdomain.jpg)  
- 문제영역(서브시스템)

### 컨텍스트경계 도출
![subdomain](https://github.com/CNAPS-MSA/CNAPS3/blob/master/img/BC.jpg)  
- 컨텍스트 경계 도출


### 컨텍스트맵
![subdomain](https://github.com/CNAPS-MSA/CNAPS3/blob/master/img/ContextMap.jpg)  
- 동기,비동기 호출 관계 정리

### 마이크로서비스별 설계

![subdomain](https://github.com/CNAPS-MSA/CNAPS3/blob/master/img/contextMap2.jpg)  
- 이벤트 스토밍 요소들을 헥사고널 아키텍처에 매핑하여 정리

|이벤트스토밍 결과물|헥사고널 아키텍처 구성요소|
|------|------|
|커맨드|API|
|어그리게잇|DATA|
|도메인이벤트|Event|
|외부시스템, 정책|I/f|





## 3.아키텍처 정의 및 개발구조정의
- 마이크로서비스 기반의 쿠버네티스 환경 , 카프카 기반 비동기 메시지 통신 활용, CQRS적용
- 내부아키텍처는 헥사고널 아키텍처를 적용
- 프론트엔드 아키텍처는

### 아키텍처구성도
- x개의 마이크로서비스 도출
- 


### 마이크로서비스 유형 정의







## 4.Rental(대여)Microservice
### BackEnd설계/구현
- 도메인 모델

- 레파지토리 구현
- 서비스 구현
- 리소스 구현

나머지 마이크로서비스 모두 등장


## 5.FrontEnd 설계/구현




## 6.마이크로서비스빌드/배포
