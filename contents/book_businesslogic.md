# 도서(Book)서비스 구현
**코드는 아무 예고 없이 언제든 변경될 수 있으니, 실제 코드는 해당 서비스 애플리케이션의 Repository에서 확인하세요.**

Sample에서 보여줄 기능은 아래와 같다.

## 구현기능
  - 도서 입고,등록 
    1. 
    2. 도서가 대여할수 있도록 등록된다. 등록 시 Catagory서비스에서 검색되도록 정보전송
    3. 렌탈서비스에서 도서대출시 도서상태 변경기능 '대여가능/대여불가' 
  - 도서대여가능여부확인
    1. 렌탈서비스에서 도서대여 가능여부 판단
    
  - 도서 예약
    1. 대출불가 상태에 있는 도서 예약처리


## API설계
주요한 API설계는 다음과 같다.

- 도서정보조회 
- 도서대여가능여부확인
- 도서예약처리

## 인바운드 어댑터


## 도메인 모델링

도서와 입고도서, 도서예약자로 구성된다.
도서공급자나 도서기증에 의해 도서가 입고되면 입고도서 객체가 생성되고 , 이 입고된 도서는 유형에 따라 분류되고 도서관이 지정되어 대여할 수 있는 도서로 등록된다.

대여할수 있게 등록된 객체가 도서이다. 도서는 이용가능을 판단하는 도서상태를 가지고 있어 대여되면 대여불가 상태가되고 반납되면 대여가능상태가 된다.

각 도서는 대여불가시 예약을 할 수 있는데 이를 도서와 도서예약자로 일다다의 관계로 표현하였다.
입고도서와 도서는 엔티티 객체이고, 도서 예약자는 VO객체이다. 
입고도서가 어그리게잇이고, 도서도 역시 어그리게잇이다. 

## 유스케이스 흐름
- 입고도서 도서등록처리
  도서공급자나 도시기증자에 의해 입고된 도서들이 대여할 수 있는 정식도서로 등록되는 절차이다.
  
  입고도서 정보를 기반으로 도서를 등록할 수도 있고 , 새로운 도서를 별도로 등록할 수도 있다. 프론트를 기반으로 데이터가 변경

- 대여가능여부 확인
대여서비스에 대여시 도서서비스를 동기호출해서 도서대여가능여부를 판단한다는 것 자체가 의존성이 있기 때문에 대여서비스와 도서서비스의 의존성을 일으킨다.
즉 도서서비스에 장애가 생긴다면 대여기능이 먹통이 될 것이다. 
이를 위해 서킷브레이크 패턴등을 적용할 수도 있겠지만 이런 동기호출의 의존성을 아예 끊어버릴 수 있다.
즉 대여시 우선 가대여를 하게 하고 가대여가 되었다는 이벤트를 던진다. 그럼 도서서비스는 대여가능여부를 판단해서 이벤트로 던져준다.
다음에 대여서비스가 던져준 이벤트 보고 판단하여 대여가능이면 가대여상태를 실대여상태로 변경하고, 대여불가이면 가대여된 것을 취소하는 보상트랜젝션처리를 한다.

이런식으로 비동기 이벤트 기반으로 변경하면 도서서비스의 의존성 없이 대여서비스가 이루어 질 수 있다. 그렇지만 대여서비스는 시간텀이 존재하는 온라인 배송만 제공하지 않고 오프라인으로 대여가 되어야 하기에 즉시성이 좀더 요구된다. 

따라서 본 예에서는 동기호출로 처리하였다. 이렇게 비즈니스에 따라 적절하게 동기 및 비동기 통신매커니즘을 결정할 수 있다.



## 내부영역 - 도메인 모델 개발

## 내부영역 - 서비스 개발

## 내부영역 - 레파지토리 개발

## 외부영역 - REST 컨트롤러 개발

## 외부영역 - 아웃바운드 어댑터 개발

## 단위테스트 수행

