# 마이크로서비스도출하기
- [마이크로서비스도출기법](https://engineering-skcc.github.io/microservice%20modeling/microservice-%EB%8F%84%EC%B6%9C%EA%B8%B0%EB%B2%95/)
- [DDD전략적설계란?](https://engineering-skcc.github.io/microservice%20modeling/ddd-Srategic-design/)
- [마이크로서비스 도출 Easy Method 이벤트스토밍](https://engineering-skcc.github.io/microservice%20modeling/Event-Storming/)
- 마이크로서비스내부구조결정가이드
## 1.마이크로서비스 도출 SAMPLE(도서대여시스템)
사례는 사내 도서대여 시스템(시스템명:티룸)이며 다음과 같은 과정을 거친다. 
## 1.요구사항 
### 1.1 요구사항 
<사용자관리 및 로그인>
- 사용자를 등록한다. 등록 시 사내HR시스템에 검증된다.
- 특정사용자는 사서의 역할을 부여 받는다.
- 사용자는 시스템 사용을 위해 로그인하거나,로 그아웃 할 수 있다.

<도서관리>
- 사서는 도서분류정보를 등록/수정/삭제한다.
- 사서는 입고된 도서를 분류하고 등록/수정/삭제한다.
- 사용자는 도서를 기증할 수 있다.
- 기증 시 10포인트를 부여 받는다.
- 일반적인 도서는 도서공급사에 의해 공급된다.
- 각 도서는 대여할 수 있는 수량(재고)이 있으며 대여/반납에 의해 그 재고가 조정된다.

<도서대출 및 반납>
- 사용자는 도서를 검색한다.
- 사용자는 베스트 대여 목록을 조회할 수 있다.
- 사용자는 재고가 있는 도서를 대여한다.(대여 조건은 2주 1인당 5권이내이다.)
- 대여 불가능한 도서는 예약 할 수 있다.
- 예약자에게는 순번이 부여된다.
- 대여 후 2주가 지나면 시스템은 반납요청메일을 보낸다.
- 사용자는 대여 기간이 2주 한도인 도서를 1주 연장할 수 있다.
- 반납되지 않고 대여 기간이 지난 도서는 연체된다.
- 1권이라도 연체 되면 사용자는 대여 불가 상태가 된다.
- 사용자는 대여한 도서를 반납할 수 있다.
- 대여한 모든 도서 이력은 기록된다.
- 대여, 반납 시 사용자에게 10포인트가 부여된다.
- 연체가 있는 있는 사용자는 대여할 수 없다.(대여불가상태)
- 포인트는 연체 1일당 10포인트씩 연체일을 감면하는데 사용된다.
- 연체일을 0으로 만듦으로써 대여가능상태가 된다.

<배송>
- 원격지의 사용자는 배송을 요청할 수 있다.
- 배송의 상태는 접수/준비/발송/배송완료 이다.
- 배송은 외부배송업체를 이용한다.

<이메일>
- 주요 업무 변화 시 이메일로 사용자에게 통보한다.

## 2.이벤트스토밍를 통한 마이크로서비스 도출
이벤트 스토밍을 통해 비지니스 흐름을 이해하고 마이크로서비스 후보를 식별해 보자. 
위에 요구사항을 사용자관리, 도서관리, 도서대출 및 반납,배송,이메일 등으로 분류하였는데 이것은 비지니스 해결을 위한 문제영역이다. 
도메인 주도설계에서는 문제 영역을 서브 도메인이라 부른다. 서브도메인 별로 이벤트 스토밍을 진행해 보자. 제일 처음은 사용자관리이다.
- 사용자 관리
![image](https://user-images.githubusercontent.com/15258916/87249288-39623800-c499-11ea-98ae-b7dd1b624428.png)

- 대출,반납
![image](https://user-images.githubusercontent.com/15258916/87249333-74646b80-c499-11ea-87df-a8a5bbca120c.png)


### 컨텍스트경계(Bounded Context) 도출
![subdomain](https://github.com/CNAPS-MSA/CNAPS3/blob/master/img/bc.jpg)  
- 컨텍스트 경계 도출


### 컨텍스트맵(Context Map)
![subdomain](https://github.com/CNAPS-MSA/CNAPS3/blob/master/img/contextMap.jpg)  
- 동기,비동기 호출 관계 정리

### 마이크로서비스별 설계

![subdomain](https://github.com/CNAPS-MSA/CNAPS3/blob/master/img/contextMap2.jpg)  
- 이벤트 스토밍 요소들을 헥사고널 아키텍처에 매핑하여 정리

|이벤트스토밍 결과물|헥사고널 아키텍처 구성요소|
|------|------|
|커맨드|API|
|어그리게잇|DATA|
|도메인이벤트|Event|
|외부시스템, 정책|I/f|











